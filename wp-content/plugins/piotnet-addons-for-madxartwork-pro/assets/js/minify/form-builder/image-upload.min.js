jQuery(document).ready(function(r){function u(){this.length=8,this.timestamp=+new Date;this.generate=function(){for(var e,a,d=this.timestamp.toString().split("").reverse(),l="",i=0;i<this.length;++i)l+=d[e=0,a=d.length-1,Math.floor(Math.random()*(a-e+1))+e];return l}}r(document).on("keyup change","[data-pafe-form-builder-image-upload]",function(){var e,i=r(this).closest("label"),o=r(this).closest(".madxartwork-element"),t=1e3;void 0!==i.attr("data-pafe-form-builder-image-upload-max-files")&&(t=parseInt(i.attr("data-pafe-form-builder-image-upload-max-files")),e=o.find(".pafe-form-builder-image-upload-placeholder.pafe-form-builder-image-upload-uploaded:not(.pafe-form-builder-image-upload-delete)").length,t-=e),r.each(r(this)[0].files,function(e,a){var l,d;0<t?(--t,"gif"!=(d=(d=a.name).substring(d.lastIndexOf(".")+1).toLowerCase())&&"png"!=d&&"jpg"!=d&&"jpeg"!=d||("undefined"!=typeof FileReader?("multiple"!=i.attr("multiple")&&i.hide(0),l=(new u).generate(),(d=new FileReader).onload=function(e){image=new Image,image.src=e.target.result,i.before('<div class="pafe-form-builder-image-upload-placeholder pafe-form-builder-image-upload-uploading" style="background-image:url('+e.target.result+')" data-pafe-form-builder-image-upload-placeholder="'+l+'"><input type="text" style="display:none;" data-pafe-form-builder-image-upload-item><span class="pafe-form-builder-image-upload-button pafe-form-builder-image-upload-button--remove" data-pafe-form-builder-image-upload-button-remove><i class="fa fa-times" aria-hidden="true"></i></span><span class="pafe-form-builder-image-upload-button pafe-form-builder-image-upload-button--uploading" data-pafe-form-builder-image-upload-button-uploading><i class="fa fa-spinner fa-spin"></i></span></div>')},d.readAsDataURL(a),(d=new FormData).append("upload",a),r.ajax({url:r("[data-pafe-form-builder-tinymce-upload]").data("pafe-form-builder-tinymce-upload"),type:"POST",data:d,processData:!1,contentType:!1,success:function(e){var a,d=JSON.parse(e),e=r(document).find('[data-pafe-form-builder-image-upload-placeholder="'+l+'"]');1==e.length&&(e.removeClass("pafe-form-builder-image-upload-uploading").addClass("pafe-form-builder-image-upload-uploaded"),e.find("input").attr("value",d.location),a="",o.find("[data-pafe-form-builder-image-upload-placeholder]:not(.pafe-form-builder-image-upload-delete) [data-pafe-form-builder-image-upload-item]").each(function(){a+=r(this).val()+","}),a=a.replace(/.$/,""),o.find("[data-pafe-form-builder-form-id]").attr("value",a),o.find("[data-pafe-form-builder-form-id]").val(a),o.find("[data-pafe-form-builder-form-id]").change())}})):alert("Your browser does not support")),0==t&&i.hide(0)):i.hide(0)})}),r(document).on("click","[data-pafe-form-builder-image-upload-button-remove]",function(){var e=r(this).closest(".pafe-form-builder-image-upload-placeholder");e.css({display:"none"}),e.addClass("pafe-form-builder-image-upload-delete");var a=r(this).closest(".madxartwork-element"),d=a.find("[data-pafe-form-builder-image-upload-placeholder]:not(.pafe-form-builder-image-upload-delete) [data-pafe-form-builder-image-upload-item]"),l="",e=a.find("[data-pafe-form-builder-image-upload-label]");0==d.length&&e.show(0),"multiple"==e.attr("multiple")&&e.show(0),d.each(function(){l+=r(this).val()+","}),l=l.replace(/.$/,""),a.find("[data-pafe-form-builder-form-id]").val(l),a.find("[data-pafe-form-builder-form-id]").change()})});