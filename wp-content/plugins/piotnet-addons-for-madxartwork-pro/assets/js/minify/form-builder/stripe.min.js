!function(n){function e(e,w){(e=e.find("[data-pafe-form-builder-stripe]")).length&&w.each(e,function(e,t){var a=w("[data-pafe-stripe]").data("pafe-stripe");if(void 0!==a){var o=Stripe(a),i=w(this).attr("data-pafe-form-builder-stripe-font-family"),a=o.elements({fonts:[{cssSrc:i}]}),i=w(this).attr("data-pafe-form-stripe-custom-style");if(i)var r=JSON.parse(i);else{let e=w(this).attr("data-pafe-form-builder-stripe-style");e=JSON.parse(e);r={base:{backgroundColor:e.backgroundColor,color:e.color,fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:e.fontSize,"::placeholder":{color:e.placeholderColor}},invalid:{color:"#fa755a",iconColor:"#fa755a"}};e.iconColor&&(r.base.iconColor=e.iconColor)}var n=a.create("card",{style:r});n.mount(t);w(t).data("pafe-form-builder-form-id")}w(document).on("click","[data-pafe-form-builder-submit-form-id][data-pafe-form-builder-stripe-submit]",function(){var _,e,v,y,k,x,C,d,l;null!=w(this).data("pafe-form-builder-stripe-submit")&&(_=w(this).data("pafe-form-builder-submit-form-id"),e=w(document).find("[data-pafe-form-builder-form-id="+_+"]"),v=w(this).data("pafe-form-builder-required-text"),y=[],k=0,x=new FormData,C=!1,d=w(this),l=d.closest(".madxartwork-element"),e.each(function(){if(null==w(this).data("pafe-form-builder-stripe")&&null==w(this).data("pafe-form-builder-html")){var e,t=w(this).closest(".madxartwork-field-type-checkbox.madxartwork-field-required"),i=0;0<t.length&&(i=t.find("input[type=checkbox]:checked").length),null!=w(this).attr("oninvalid")&&(v=w(this).attr("oninvalid").replace("this.setCustomValidity('","").replace("')","")),null!=w(this).attr("data-pafe-is-repassword")&&""!=w(this).attr("data-pafe-is-repassword")&&(e=w('[name="form_fields['+w(this).attr("data-pafe-is-repassword")+']"]').val(),r=w(this).attr("data-pafe-repassword-msg"),String(e)!==String(w(this).val())?(this.setCustomValidity(r),k++,w(this).on("keyup",function(){this.setCustomValidity("")})):this.setCustomValidity("")),void 0!==w(this).attr("data-pafe-confirm-field")&&!1!==w(this).attr("data-pafe-confirm-field")&&(d=w('[name="form_fields['+w(this).attr("data-pafe-confirm-field")+']"]').val(),s=w(this).attr("data-pafe-confirm-msg"),String(d)!==String(w(this).val())?(this.setCustomValidity(s),k++,w(this).on("keyup",function(){this.setCustomValidity("")})):this.setCustomValidity(""));var r=w(this)[0].checkValidity(),d=w(w(this)[0]).next()[0];if(w(d).hasClass("flatpickr-mobile")&&(r=d.checkValidity()),!r&&0==w(this).closest(".pafe-form-builder-conditional-logic-hidden").length&&"none"!=w(this).closest("[data-pafe-form-builder-conditional-logic]").css("display")&&0==w(this).closest("[data-pafe-signature]").length||0==i&&0<t.length&&"none"!=w(this).closest(".madxartwork-element").css("display"))"none"==w(this).css("display")||null!=w(this).data("pafe-form-builder-image-select")||null!=w(this).data("pafe-form-builder-select-autocomplete")||0<t.length?(w(this).closest(".madxartwork-field-group").find("[data-pafe-form-builder-required]").html(v),0===(a=w(this).closest(".madxartwork-field-group").find("[data-pafe-form-builder-required]").next()).length||C||(w("html, body").animate({scrollTop:a.offset().top},500),C=!0)):C||null!=w(this).data("pafe-form-builder-image-select")||(w(this)[0].reportValidity(),C=!0),k++;else if(""==w(this).val()&&0==w(this).closest(".pafe-form-builder-conditional-logic-hidden").length&&"true"==w(this).attr("aria-required")&&void 0!==w(this).attr("data-pafe-form-builder-select-autocomplete"))w(this).closest(".madxartwork-field-group").find("[data-pafe-form-builder-required]").html(v),k++;else{null!=w(this).data("pafe-form-builder-image-select")&&(w(this).closest(".pafe-image-select-field").find(".image_picker_selector").find(".selected").length<w(this).data("pafe-form-builder-image-select-min-select")?(w(this).closest(".madxartwork-field-group").find("[data-pafe-image_select_min_select_check]").html(w(this).data("pafe-form-builder-image-select-min-select-message")),k++):w(this).closest(".madxartwork-field-group").find("[data-pafe-image_select_min_select_check]").remove()),w(this).closest(".madxartwork-field-group").find("[data-pafe-form-builder-required]").html(""),null!=w(this).data("pafe-flatpickr-custom-options")&&""==w(this).val()&&0==w(this).closest(".pafe-form-builder-conditional-logic-hidden").length&&null!=w(this).attr("required")&&(w(this).closest(".madxartwork-field-group").find("[data-pafe-form-builder-required]").html(v),k++),0<w(this).closest("[data-pafe-signature]").length&&(w(this).closest("[data-pafe-signature]").find("[data-pafe-signature-export]").trigger("click"),""==w(this).val()&&0==w(this).closest(".pafe-form-builder-conditional-logic-hidden").length&&"required"==w(this).attr("required")&&(w(this).closest(".madxartwork-field-group").find("[data-pafe-form-builder-required]").html(v),k++));var a,l,o=w(this).attr("type"),n=w(this).attr("name"),s=w(this).closest("[data-pafe-form-builder-repeater-form-id]"),f="",d="",r="",i=-1,t=0;if(0<s.length&&($repeaterParents=w(this).parents("[data-pafe-form-builder-repeater-form-id]"),d=s.data("pafe-form-builder-repeater-id"),$repeaterParents.each(function(){var e=w(this).data("pafe-form-builder-repeater-id"),t=w(document).find('[data-pafe-form-builder-repeater-form-id="'+_+'"][data-pafe-form-builder-repeater-id="'+e+'"]');repeaterParentIndex=w(this).index()-t.index(),f+=e+"|index"+repeaterParentIndex+"|"+n.replace("[]","").replace("form_fields[","").replace("]","")+","}),r=s.data("pafe-form-builder-repeater-label"),a=w(document).find('[data-pafe-form-builder-repeater-id="'+s.data("pafe-form-builder-repeater-id")+'"]'),t=s.siblings('[data-pafe-form-builder-repeater-id="'+s.data("pafe-form-builder-repeater-id")+'"]').length+1,i=s.index()-a.index()),"file"==o)if(w(this).hasClass("error"))k++;else{let a=[];var m,n=w(this).attr("id").replace("form-field-","");w.each(w(this)[0].files,function(e,t){a.push(t.name),x.append(n+"[]",t)}),(m={}).label=w(this).closest(".madxartwork-field-group").find(".madxartwork-field-label").html(),m.name=n,m.value="",m.type=w(this).attr("type"),m.upload=1,m.file_name=a,m.repeater_id=f,m.repeater_id_one=d,m.repeater_label=r,m.repeater_index=i,m.repeater_length=t,null!=w(this).data("pafe-form-builder-remove-this-field-from-repeater")&&(m.repeater_remove_this_field="1"),null!=w(this).data("pafe-form-builder-remove-this-field-from-repeater")&&(m.repeater_remove_this_field="1"),null!=w(this).data("attach-files")&&(m["attach-files"]=1),y.push(m)}else{if(-1!==n.indexOf("[]")){var p=[];"checkbox"==o?w(this).closest(".madxartwork-element").find('[name="'+n+'"]:checked').each(function(){p.push(w(this).val())}):null==(p=w(this).val())&&(p=[]);for(var c,u,h=l="",b=[],g=0;g<p.length;g++)null!=w(this).data("pafe-form-builder-send-data-by-label")&&(c=p[g],"checkbox"==o?0<(u=w(this).closest(".madxartwork-element").find('[value="'+c+'"]')).length&&(h+=u.data("pafe-form-builder-send-data-by-label")+","):0<(u=w(this).find('[value="'+c+'"]')).length&&(h+=u.html()+",")),l+=p[g]+",",null!=w(this).attr("data-pafe-form-booking-item-options")&&(c=p[g],0<(u=w(this).closest(".madxartwork-element").find('[value="'+c+'"]')).length&&b.push(u.attr("data-pafe-form-booking-item-options")));l=l.replace(/,(\s+)?$/,"")}else"radio"==o||"checkbox"==o?(null!=w(this).data("pafe-form-builder-send-data-by-label")&&(h=w(this).closest(".madxartwork-element").find('[name="'+n+'"]:checked').data("pafe-form-builder-send-data-by-label")),l=(l=w(this).closest(".madxartwork-element").find('[name="'+n+'"]:checked').val())||""):null!=w(this).data("pafe-form-builder-calculated-fields")?l=w(this).siblings(".pafe-calculated-fields-form").text():(null!=w(this).data("pafe-form-builder-send-data-by-label")&&(null!==w(this).val()&&(c=w(this).val().trim()),0<(u=w(this).find('[value="'+c+'"]')).length&&(h=u.html())),null!==w(this).val()&&(l=w(this).val().trim()));null!=l&&((m={}).label=w(this).closest(".madxartwork-field-group").find(".madxartwork-field-label").html(),m.name=n.replace("[]","").replace("form_fields[","").replace("]",""),m.value=l,null!=p&&(m.value_multiple=p),m.type=w(this).attr("type"),void 0!==w(this).attr("data-pafe-form-builder-address-autocomplete")&&(m.lat=w(this).attr("data-pafe-form-builder-google-maps-lat"),m.lng=w(this).attr("data-pafe-form-builder-google-maps-lng"),m.zoom=w(this).attr("data-pafe-form-builder-google-maps-zoom")),void 0!==b&&0<b.length&&(m.booking=b),""!=h&&(m.value_label=h),0<w(this).closest(".madxartwork-field-type-calculated_fields").length&&(m.calculation_results=w(this).val().trim()),0==w(this).closest(".pafe-form-builder-conditional-logic-hidden").length&&(m.repeater_id=f,m.repeater_id_one=d,m.repeater_index=i,m.repeater_label=r,m.repeater_length=t,null!=w(this).data("pafe-form-builder-remove-this-field-from-repeater")&&(m.repeater_remove_this_field="1")),null!=w(this).attr("data-pafe-remove-value")&&"false"!=w(this).attr("data-pafe-remove-value")&&w(this).val()==w(this).attr("data-pafe-remove-value")&&(m.value=""),y.push(m))}}}}),0==k&&o.createToken(n).then(function(e){var i,t,a,r;e.error||(w(document).find('[data-pafe-form-builder-form-id="'+_+'"]').closest(".madxartwork-element").css({opacity:.45}),d.closest(".madxartwork-element").css({opacity:.45}),d.closest(".madxartwork-element").addClass("madxartwork-form-waiting"),l.find(".madxartwork-message").removeClass("visible"),i=0,null!=d.data("pafe-form-builder-stripe-amount")?i=d.data("pafe-form-builder-stripe-amount"):null!=d.data("pafe-form-builder-stripe-amount-field")&&(t=d.data("pafe-form-builder-stripe-amount-field").replace('[field id="',"").replace('"]',""),i=w(document).find('[data-pafe-form-builder-form-id="'+_+'"][name="form_fields['+t+']"]').val()),a="",null!=d.data("pafe-form-builder-stripe-customer-info-field")&&(t=d.data("pafe-form-builder-stripe-customer-info-field").replace('[field id="',"").replace('"]',""),a=w(document).find('[data-pafe-form-builder-form-id="'+_+'"][name="form_fields['+t+']"]').val()),w(document).find('input[name="post_id"][data-pafe-form-builder-hidden-form-id="'+_+'"]').eq(0).closest("[data-madxartwork-id]").data("madxartwork-id"),w(document).find('input[name="form_id"][data-pafe-form-builder-hidden-form-id="'+_+'"]').val(),e.token.id,x.append("action","pafe_ajax_stripe_intents"),x.append("post_id",l.find('input[name="post_id"]').closest("[data-madxartwork-id]").data("madxartwork-id")),x.append("form_id",l.find('input[name="form_id"]').val()),x.append("fields",JSON.stringify(y)),x.append("referrer",window.location.href),x.append("remote_ip",w(document).find('input[name="remote_ip"][data-pafe-form-builder-hidden-form-id="'+_+'"]').val()),x.append("stripeToken",e.token.id),x.append("amount",i),x.append("description",a),null!=w(this).data("pafe-form-builder-woocommerce-product-id")&&x.append("product_id",w(this).data("pafe-form-builder-woocommerce-product-id")),null!=d.data("pafe-form-builder-submit-post-edit")&&x.append("edit",d.data("pafe-form-builder-submit-post-edit")),null!=d.data("pafe-form-builder-submit-recaptcha")?(r=d.data("pafe-form-builder-submit-recaptcha"),grecaptcha.ready(function(){grecaptcha.execute(r,{action:"create_comment"}).then(function(e){x.append("recaptcha",e),o.createPaymentMethod("card",n,{}).then(function(e){e.error||(x.append("payment_method_id",e.paymentMethod.id),w.ajax({url:w("[data-pafe-ajax-url]").data("pafe-ajax-url"),type:"POST",data:x,processData:!1,contentType:!1,success:function(e){var t=w(document).find('input[name="post_id"][data-pafe-form-builder-hidden-form-id="'+_+'"]').eq(0).closest("[data-madxartwork-id]").data("madxartwork-id"),a=JSON.stringify(y);s(JSON.parse(e),t,_,a,i,o,x,w(this));n.clear()},error:function(){w(document).find('[data-pafe-form-builder-form-id="'+_+'"]').closest(".madxartwork-element").css({opacity:1}),l.css({opacity:1}),l.removeClass("madxartwork-form-waiting"),l.find(".pafe-form-builder-alert--stripe .madxartwork-message-danger").addClass("visible"),l.find("[data-pafe-form-builder-trigger-failed]").trigger("click"),n.clear()}}))})})})):o.createPaymentMethod("card",n,{}).then(function(e){e.error||(x.append("payment_method_id",e.paymentMethod.id),w.ajax({url:w("[data-pafe-ajax-url]").data("pafe-ajax-url"),type:"POST",data:x,processData:!1,contentType:!1,success:function(e){var t=w(document).find('input[name="post_id"][data-pafe-form-builder-hidden-form-id="'+_+'"]').eq(0).closest("[data-madxartwork-id]").data("madxartwork-id"),a=JSON.stringify(y);s(JSON.parse(e),t,_,a,i,o,x,w(this));n.clear()},error:function(){w(document).find('[data-pafe-form-builder-form-id="'+_+'"]').closest(".madxartwork-element").css({opacity:1}),l.css({opacity:1}),l.removeClass("madxartwork-form-waiting"),l.find(".pafe-form-builder-alert--stripe .madxartwork-message-danger").addClass("visible"),l.find("[data-pafe-form-builder-trigger-failed]").trigger("click"),n.clear()}}))}))}))})})}function s(t,a,i,r,d,l,o){t.error?f("failed",0,i,o,0,t):t.requires_action?t.subscriptions?l.handleCardPayment(t.payment_intent_client_secret).then(function(e){e.error||f("succeeded",0,i,o,0,t)}):l.handleCardAction(t.payment_intent_client_secret).then(function(e){e.error?f("failed",0,i,o,0,t):(o.delete("payment_method_id"),o.append("payment_intent_id",e.paymentIntent.id),n.ajax({url:n("[data-pafe-ajax-url]").data("pafe-ajax-url"),type:"POST",data:o,processData:!1,contentType:!1,success:function(e){s(JSON.parse(e),a,i,r,d,l,o)}}))}):f("succeeded",0,i,o,0,t)}function f(r,e,d,t,a,i){var l=n(document).find('[data-pafe-form-builder-submit-form-id="'+d+'"]').closest(".madxartwork-element");"failed"==r?(n(document).find('[data-pafe-form-builder-form-id="'+d+'"]').closest(".madxartwork-element").css({opacity:1}),l.css({opacity:1}),l.removeClass("madxartwork-form-waiting"),l.find(".pafe-form-builder-alert--stripe .madxartwork-message-danger").addClass("visible"),n(document).find('[data-pafe-form-builder-submit-form-id="'+d+'"]').closest(".madxartwork-element").css({opacity:1}),l.find("[data-pafe-form-builder-trigger-failed]").trigger("click")):(t.delete("stripeToken"),t.delete("action"),t.append("action","pafe_ajax_form_builder"),t.append("payment_intent_id",i.payment_intent_id),n.ajax({url:n("[data-pafe-ajax-url]").data("pafe-ajax-url"),type:"POST",data:t,processData:!1,contentType:!1,success:function(e){var t,a,i;n(document).find('[data-pafe-form-builder-form-id="'+d+'"]').closest(".madxartwork-element").css({opacity:1}),l.css({opacity:1}),l.removeClass("madxartwork-form-waiting"),-1!==(e=e.trim()).indexOf(",")&&((t=JSON.parse(e)).custom_message&&l.find("[data-pafe-form-builder-message]").html(t.custom_message),l.find(".madxartwork-message").each(function(){var e;""!=t.post_url&&(e=n(this).html().replace("[post_url]",'<a href="'+t.post_url+'">'+t.post_url+"</a>"),n(this).html(e))}),"succeeded"==r||"active"==r?(l.find(".pafe-form-builder-alert--stripe .madxartwork-message-success").addClass("visible"),l.find("[data-pafe-form-builder-trigger-success]").trigger("click")):(l.find(".pafe-form-builder-alert--stripe .madxartwork-message-danger").addClass("visible"),n(document).find('[data-pafe-form-builder-form-id="'+d+'"]').closest(".madxartwork-element").css({opacity:1}),n(document).find('[data-pafe-form-builder-submit-form-id="'+d+'"]').closest(".madxartwork-element").css({opacity:1}),l.find("[data-pafe-form-builder-trigger-failed]").trigger("click")),""!=t.status?l.find(".pafe-form-builder-alert--mail .madxartwork-message-success").addClass("visible"):(l.find(".pafe-form-builder-alert--mail .madxartwork-message-danger").addClass("visible"),n(document).find('[data-pafe-form-builder-form-id="'+d+'"]').closest(".madxartwork-element").css({opacity:1}),n(document).find('[data-pafe-form-builder-submit-form-id="'+d+'"]').closest(".madxartwork-element").css({opacity:1}),""!=t.register_message&&l.find(".pafe-form-builder-alert--mail .madxartwork-message-danger").html(t.register_message.replace(/###/g,","))),0!=l.find('input[name="redirect"]').length&&(a=l.find('input[name="redirect"]').val().trim(),i=l.find('input[name="redirect"]').attr("data-pafe-form-builder-open-new-tab"),-1!==e.indexOf(",")&&"1"!=t.failed_status&&(""!=t.post_url&&"[post_url]"==a?window.location.href=t.post_url:""!=t.redirect&&("yes"==i?window.open(t.redirect,"_blank"):window.location.href=t.redirect))),0!=n(document).find('[data-pafe-form-builder-popup][data-pafe-form-builder-hidden-form-id="'+d+'"]').length&&$submit.closest(".madxartwork-widget-container").find('[data-pafe-form-builder-hidden-form-id="'+d+'"]').trigger("click"),t.popup&&0!=n(document).find('[data-pafe-form-builder-popup-open][data-pafe-form-builder-hidden-form-id="'+d+'"]').length&&$submit.closest(".madxartwork-widget-container").find('[data-pafe-form-builder-hidden-form-id="'+d+'"]').trigger("click"),0!=n(document).find('[data-pafe-form-builder-popup-close][data-pafe-form-builder-hidden-form-id="'+d+'"]').length&&$submit.closest(".madxartwork-widget-container").find('[data-pafe-form-builder-hidden-form-id="'+d+'"]').trigger("click"))}}))}n(window).on("madxartwork/frontend/init",function(){madxartworkFrontend.hooks.addAction("frontend/element_ready/pafe-form-builder-field.default",e)})}(jQuery);