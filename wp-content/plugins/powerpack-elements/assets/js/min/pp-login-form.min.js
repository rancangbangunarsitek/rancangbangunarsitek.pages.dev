!function(p){window.onLoadPPReCaptcha=function(){var o,e=p(".pp-grecaptcha");0<e.length&&e.each(function(e){var t=p(this),i=t.attr("data-widgetid"),n=p(this).attr("id");typeof i!=typeof undefined&&!1!==i||(t.attr("id",n),o=grecaptcha.render(n,{sitekey:t.data("sitekey"),theme:t.data("theme"),size:t.data("validate"),callback:function(e){""!=e&&(t.attr("data-pp-grecaptcha-response",e),"invisible"==t.data("validate")&&t.closest(".madxartwork-widget").find(".pp-submit-button").trigger("click"))}}),t.attr("data-widgetid",o))})};(PPLoginForm=function(e,t,i){this.node=e,this.id=i.id,this.messages=i.messages,this.settings=i,this.elementSettings=t,this.i18n=i.i18n,this.form=p(this.node).find(".pp-login-form"),this.passwordField=this.form.find(".pp-lf-field-pw-toggle"),this._init()}).prototype={settings:{},isGoogleLoginClicked:!1,_init:function(){0<this.passwordField.find(".pp-lf-toggle-pw").length&&this.passwordField.find(".pp-lf-toggle-pw").on("click",p.proxy(this._passwordToggle,this)),this.settings.facebook_login&&this._initFacebookLogin(),this.settings.google_login&&this._initGoogleLogin(),0<this.node.find("#pp-form-"+this.id).length&&"yes"===this.elementSettings.enable_ajax&&this.node.find("#pp-form-"+this.id).on("submit",p.proxy(this._loginFormSubmit,this)),0<this.node.find(".pp-login-form--lost-pass").length&&this.node.find(".pp-login-form--lost-pass").on("submit",p.proxy(this._lostPassFormSubmit,this)),0<this.node.find(".pp-login-form--reset-pass").length&&this.node.find(".pp-login-form--reset-pass").on("submit",p.proxy(this._resetPassFormSubmit,this)),this.settings.enable_recaptcha&&this._initReCaptcha()},_passwordToggle:function(){var e=this.passwordField;"text"===(pwFieldControl=e.find('.madxartwork-field[name="pwd"]')).attr("type")?(pwFieldControl.attr("type","password"),e.find(".pp-lf-toggle-pw").attr("aria-label",this.i18n.pw_toggle_text.show).find("span").removeClass("fa-eye-slash").addClass("fa-eye")):(pwFieldControl.attr("type","text"),e.find(".pp-lf-toggle-pw").attr("aria-label",this.i18n.pw_toggle_text.hide).find("span").removeClass("fa-eye").addClass("fa-eye-slash"))},_initReCaptcha:function(){var e=this.node.find(".pp-grecaptcha");madxartworkFrontend.isEditMode()&&undefined==e.attr("data-widgetid")&&onLoadPPReCaptcha()},_initFacebookLogin:function(){""!==this.settings.facebook_app_id&&0<this.node.find(".pp-fb-login-button").length&&(this._initFacebookSDK(),this.node.find(".pp-fb-login-button").on("click",p.proxy(this._facebookLoginClick,this)))},_initFacebookSDK:function(){var e=this,t=(0===p("#fb-root").length&&p("body").prepend('<div id="fb-root"></div>'),document),i="script",n="facebook-jssdk",o=t.getElementsByTagName(i)[0];t.getElementById(n)||((i=t.createElement(i)).id=n,i.src="//connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(i,o),window.fbAsyncInit=function(){FB.init({appId:e.settings.facebook_app_id,cookie:!0,xfbml:!0,version:"v2.12"})})},_facebookLoginClick:function(){var i=this,e=this.node.find(".pp-login-form").find('input[name="redirect_to"]'),n={action:"pp_lf_process_social_login",provider:"facebook",page_url:i.settings.page_url,nonce:i._getNonce()};0<e.length&&""!==e.val()&&(n.redirect=e.val()),this._disableForm(),FB.login(function(e){"connected"===e.status?FB.api("/me",{fields:"id, email, name, first_name, last_name"},function(e){var t=FB.getAuthResponse();n.user_data=e,n.auth_response=t,i._ajax(n,function(e){e.success?e.data.redirect_url?window.location.href=e.data.redirect_url:window.location.reload():(console.error(e.data),i._enableForm())})}):(e.authResponse&&console.error("PP Login Form: Unable to connect Facebook account."),i._enableForm())},{scope:"email",return_scopes:!0})},_initGoogleLogin:function(){""!==this.settings.google_client_id&&0<this.node.find(".pp-google-login-button").length&&(this._initGoogleApi(),this.node.find(".pp-google-login-button").on("click",p.proxy(this._googleLoginClick,this)))},_initGoogleApi:function(){var i,n=this,e=this.node.find(".pp-login-form").find('input[name="redirect_to"]');"undefined"!=typeof gapi&&""!==n.settings.google_client_id&&(i={action:"pp_lf_process_social_login",provider:"google",page_url:n.settings.page_url,nonce:n._getNonce()},0<e.length&&""!==e.val()&&(i.redirect=e.val()),gapi.load("auth2",function(){(auth2=gapi.auth2.init({client_id:n.settings.google_client_id,cookiepolicy:"single_host_origin"})).attachClickHandler("pp-google-login-button",{},function(e){var t=e.getBasicProfile();i.user_data={name:t.getName(),email:t.getEmail(),hash:e.getAuthResponse().id_token},n.isGoogleLoginClicked&&n._ajax(i,function(e){var t;e.success?e.data.redirect_url?(t=location.protocol+"//"+location.host,(""===e.data.redirect_url.split(t)[0]?e.data.redirect_url.split(t)[1]:e.data.redirect_url.split(t)[0])===location.href.split(t)[1]?window.location.reload():window.location.href=e.data.redirect_url):window.location.reload():(console.error(e.data),n._enableForm()),n.isGoogleLoginClicked=!1})},function(e){console.error(e),n._enableForm()})}))},_googleLoginClick:function(){this.isGoogleLoginClicked=!0,this._disableForm()},_loginFormSubmit:function(e){e.preventDefault();var i=p(e.target),e=i.find('input[name="log"]'),t=i.find('input[name="pwd"]'),n=i.find('input[name="rememberme"]'),o=i.find('input[name="redirect_to"]'),a=i.find(".pp-grecaptcha"),s=a.data("pp-grecaptcha-response"),r=this;if(e.parent().find(".pp-lf-error").remove(),t.parent().find(".pp-lf-error").remove(),a.parent().find(".pp-lf-error").remove(),""===e.val().trim())p('<span class="pp-lf-error">').insertAfter(e).html(this.messages.empty_username);else if(""===t.val())p('<span class="pp-lf-error">').insertAfter(t).html(this.messages.empty_password);else{if(0<a.length&&(void 0===s||!1===s)){if("normal"==a.data("validate"))return void p('<span class="pp-lf-error">').insertAfter(a).html(this.messages.empty_recaptcha);"invisible"==a.data("validate")&&grecaptcha.execute(a.data("widgetid"))}var l=new FormData(i[0]);l.append("action","ppe_lf_process_login"),l.append("page_url",this.settings.page_url),l.append("username",e.val()),l.append("password",t.val()),0<o.length&&""!==o.val()&&l.append("redirect",o.val()),0<n.length&&n.is(":checked")&&l.append("remember","1"),0<a.length&&(l.append("recaptcha",!0),l.append("recaptcha_validate",a.data("validate")),l.append("recaptcha_validate_type",a.data("validate-type"))),s&&l.append("recaptcha_response",s),this._disableForm(),this._ajax(l,function(e){var t;e.success?e.data.redirect_url?(t=location.protocol+"//"+location.host,(""===e.data.redirect_url.split(t)[0]?e.data.redirect_url.split(t)[1]:e.data.redirect_url.split(t)[0])===location.href.split(t)[1]?window.location.reload():window.location.href=e.data.redirect_url):window.location.reload():(r._enableForm(),i.find(".pp-lf-error").remove(),p('<span class="pp-lf-error">').appendTo(i).html(e.data))})}},_lostPassFormSubmit:function(e){e.preventDefault();var t,i=p(e.target),n=i.find('input[name="user_login"]'),e=i.find('input[name="lost_redirect_to"]'),o=i.find('input[name="is_lost_redirect"]'),a=this;n.parent().find(".pp-lf-error").remove(),""===n.val().trim()?p('<span class="pp-lf-error">').insertAfter(n).html(this.messages.empty_username):((t=new FormData(i[0])).append("action","pp_lf_process_lost_pass"),t.append("page_url",this.settings.page_url),0<e.length&&""!==e.val()&&t.append("redirect",e.val()),this._disableForm(),this._ajax(t,function(e){var t;a._enableForm(),e.success?"0"===o.val()?(p('<p class="pp-lf-success">').insertAfter(i).html(a.messages.email_sent),i.hide()):e.data.redirect_url?(t=location.protocol+"//"+location.host,(""===e.data.redirect_url.split(t)[0]?e.data.redirect_url.split(t)[1]:e.data.redirect_url.split(t)[0])===location.href.split(t)[1]?window.location.reload():(window.location.href=e.data.redirect_url,p('<p class="pp-lf-success">').insertAfter(i).html(a.messages.email_sent),i.hide())):window.location.reload():(n.parent().find(".pp-lf-error").remove(),p('<span class="pp-lf-error">').insertAfter(n).html(e.data))}))},_resetPassFormSubmit:function(e){e.preventDefault();var t=p(e.target),e=t.find('input[name="password_1"]'),i=t.find('input[name="password_2"]'),n=this;e.parent().find(".pp-lf-error").remove(),i.parent().find(".pp-lf-error").remove(),""===e.val()?p('<span class="pp-lf-error">').insertAfter(e).html(this.messages.empty_password_1):""===i.val()?p('<span class="pp-lf-error">').insertAfter(i).html(this.messages.empty_password_2):((e=new FormData(t[0])).append("action","pp_lf_process_reset_pass"),e.append("page_url",this.settings.page_url),this._disableForm(),this._ajax(e,function(e){n._enableForm(),e.success?(p('<p class="pp-lf-success">').insertAfter(t).html(n.messages.reset_success),t.hide()):(t.find(".pp-lf-error").remove(),p('<span class="pp-lf-error">').appendTo(t).html(e.data))}))},_enableForm:function(){this.node.find(".pp-login-form-wrap").removeClass("pp-event-disabled")},_disableForm:function(){this.node.find(".pp-login-form-wrap").addClass("pp-event-disabled")},_getNonce:function(){return this.node.find('.pp-login-form input[name="ppe-lf-login-nonce"]').val()},_ajax:function(e,t){var i={type:"POST",url:ppLogin.ajax_url,data:e,dataType:"json",success:function(e){"function"==typeof t&&t(e)},error:function(e,t){console.log(t)}};"undefined"==typeof e.provider&&(i.processData=!1,i.contentType=!1),p.ajax(i)}}}(jQuery);